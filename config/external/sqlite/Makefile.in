# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

LIB_IS_C_ONLY    = 1

include $(topsrcdir)/config/config.mk

ifeq ($(OS_ARCH),WINNT)
# This needs to stay there for now
DEFFILE = $(DEPTH)/db/sqlite3/src/sqlite-processed.def

else
ifndef MOZ_FOLD_LIBS
ifeq ($(OS_ARCH),OS2)
# We have to preprocess our def file because we need different symbols in debug
# builds exposed that are not built in non-debug builds.
ADD_TO_DEF_FILE = $(call py_action,preprocessor,$(DEFINES) $(ACDEFINES) $(MOZ_DEBUG_DEFINES) \
       $(topsrcdir)/db/sqlite3/src/sqlite.def) | sed -e '1,/^EXPORTS$$/ d' -e 's,sqlite3,_\0,' \
       -e 's,\ DATA.*$$,,' >> $(DEF_FILE)
else
ifdef GCC_USE_GNU_LD

GARBAGE += \
  $(LD_VERSION_SCRIPT) \
  $(NULL)

# Convert to the format we need for ld.
$(LD_VERSION_SCRIPT): $(topsrcdir)/db/sqlite3/src/sqlite.def
	@$(call py_action,convert_def_file, \
	  $(DEFINES) $(ACDEFINES) $(MOZ_DEBUG_DEFINES) -o $@ $^)

endif
endif
endif
endif
